<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <title id="page-title">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - HASTANE</title>
    <style>
        :root { --primary: #1b4332; --bg: #f4f7f6; --danger: #c0392b; --white: #fff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; transition: 0.3s; }
        
        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .sidebar { 
            width: 260px; background: var(--primary); color: white; height: 100vh; 
            padding: 25px; position: fixed; right: 0; transition: 0.3s; 
        }
        [dir="ltr"] .sidebar { right: auto; left: 0; }

        .sidebar h2 { font-size: 1.5rem; border-bottom: 1px solid #ffffff33; padding-bottom: 15px; }
        .sidebar a { display: block; color: #a3b18a; text-decoration: none; padding: 12px 0; transition: 0.3s; cursor: pointer; }
        .sidebar a:hover { color: white; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .content { margin-right: 260px; padding: 40px; width: calc(100% - 260px); transition: 0.3s; }
        [dir="ltr"] .content { margin-right: 0; margin-left: 260px; }

        .admin-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 30px; }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„ØºØ© */
        .lang-box { margin-bottom: 20px; display: flex; gap: 5px; }
        .lang-btn { background: #ffffff22; border: 1px solid #ffffff44; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
        .lang-btn:hover { background: #ffffff44; }

        table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; text-align: inherit; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: var(--primary); }
        
        .btn-del { background: var(--danger); color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; width: 100%; max-width: 300px; margin-bottom: 10px; display: block; }
        .update-btn { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2 id="side-title">HASTANE Admin</h2>
        <div class="lang-box">
            <button class="lang-btn" onclick="setLanguage('ar')">AR</button>
            <button class="lang-btn" onclick="setLanguage('tr')">TR</button>
            <button class="lang-btn" onclick="setLanguage('en')">EN</button>
        </div>
        <a href="index.html" id="link-back">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</a>
        <a id="link-pharm">ğŸ’Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª</a>
        <a id="link-book">ğŸ“… Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</a>
    </div>

    <div class="content">
        <div class="admin-card">
            <h3 id="card-ph-title" style="color:var(--primary);">ğŸ“ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©</h3>
            <input type="text" id="nName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
            <input type="text" id="nLoc" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹">
            <button onclick="updateN()" id="btn-update" class="update-btn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>

        <div class="admin-card">
            <h3 id="card-list-title" style="color:var(--primary);">ğŸ“… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©</h3>
            <table>
                <thead>
                    <tr>
                        <th id="th-patient">Ø§Ù„Ù…Ø±ÙŠØ¶</th>
                        <th id="th-id">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ</th>
                        <th id="th-doc">Ø§Ù„Ø·Ø¨ÙŠØ¨</th>
                        <th id="th-time">Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</th>
                        <th id="th-act">Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="bTable"></tbody>
            </table>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBD2Ge6v0TStampv_l_bRGnzTDVPKvCW20",
            authDomain: "hastane-b2c48.firebaseapp.com",
            projectId: "hastane-b2c48",
            storageBucket: "hastane-b2c48.firebasestorage.app",
            messagingSenderId: "788913029956",
            appId: "1:788913029956:web:84c2f36a5569c85bfd8d11"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const translations = {
            ar: {
                title: "Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - HASTANE",
                sideTitle: "Ø¥Ø¯Ø§Ø±Ø© HASTANE",
                back: "ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹",
                managePh: "ğŸ’Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ§Øª",
                records: "ğŸ“… Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
                phCard: "ğŸ“ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø©",
                phPlace: "Ø§Ø³Ù… Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©",
                locPlace: "Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹",
                updateBtn: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                listTitle: "ğŸ“… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©",
                thPatient: "Ø§Ù„Ù…Ø±ÙŠØ¶",
                thId: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ",
                thDoc: "Ø§Ù„Ø·Ø¨ÙŠØ¨",
                thTime: "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø®ØªØ§Ø±",
                thAct: "Ø¥Ø¬Ø±Ø§Ø¡",
                delBtn: "Ø­Ø°Ù",
                msgSuccess: "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!",
                msgConfirm: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ØŸ",
                dir: "rtl"
            },
            tr: {
                title: "YÃ¶netici Paneli - HASTANE",
                sideTitle: "HASTANE Admin",
                back: "ğŸ  Siteye DÃ¶n",
                managePh: "ğŸ’Š Eczane YÃ¶netimi",
                records: "ğŸ“… Randevu KayÄ±tlarÄ±",
                phCard: "ğŸ“ NÃ¶betÃ§i Eczaneyi GÃ¼ncelle",
                phPlace: "Eczane AdÄ±",
                locPlace: "Konum Linki",
                updateBtn: "Verileri GÃ¼ncelle",
                listTitle: "ğŸ“… Rezerve Edilen Randevular",
                thPatient: "Hasta",
                thId: "T.C. Kimlik",
                thDoc: "Doktor",
                thTime: "SeÃ§ilen Saat",
                thAct: "Ä°ÅŸlem",
                delBtn: "Sil",
                msgSuccess: "BaÅŸarÄ±yla gÃ¼ncellendi!",
                msgConfirm: "Bu randevuyu silmek istediÄŸinizden emin misiniz?",
                dir: "ltr"
            },
            en: {
                title: "Admin Panel - HASTANE",
                sideTitle: "HASTANE Admin",
                back: "ğŸ  Back to Site",
                managePh: "ğŸ’Š Manage Pharmacies",
                records: "ğŸ“… Booking Records",
                phCard: "ğŸ“ Update On-duty Pharmacy",
                phPlace: "Pharmacy Name",
                locPlace: "Location Link",
                updateBtn: "Update Data",
                listTitle: "ğŸ“… Booked Appointments List",
                thPatient: "Patient",
                thId: "National ID",
                thDoc: "Doctor",
                thTime: "Selected Time",
                thAct: "Action",
                delBtn: "Delete",
                msgSuccess: "Updated successfully!",
                msgConfirm: "Are you sure you want to delete this appointment?",
                dir: "ltr"
            }
        };

        function setLanguage(lang) {
            localStorage.setItem('lang', lang);
            const t = translations[lang];
            const html = document.getElementById('main-html');
            html.dir = t.dir;
            html.lang = lang;

            document.getElementById('page-title').innerText = t.title;
            document.getElementById('side-title').innerText = t.sideTitle;
            document.getElementById('link-back').innerText = t.back;
            document.getElementById('link-pharm').innerText = t.managePh;
            document.getElementById('link-book').innerText = t.records;
            document.getElementById('card-ph-title').innerText = t.phCard;
            document.getElementById('nName').placeholder = t.phPlace;
            document.getElementById('nLoc').placeholder = t.locPlace;
            document.getElementById('btn-update').innerText = t.updateBtn;
            document.getElementById('card-list-title').innerText = t.listTitle;
            document.getElementById('th-patient').innerText = t.thPatient;
            document.getElementById('th-id').innerText = t.thId;
            document.getElementById('th-doc').innerText = t.thDoc;
            document.getElementById('th-time').innerText = t.thTime;
            document.getElementById('th-act').innerText = t.thAct;
            
            loadData(lang);
        }

        async function updateN() {
            const lang = localStorage.getItem('lang') || 'ar';
            const n = document.getElementById('nName').value;
            const l = document.getElementById('nLoc').value;
            if(!n || !l) return;
            await db.collection("settings").doc("pharmacy").set({ 
                name: n, 
                location: l, 
                timestamp: firebase.firestore.FieldValue.serverTimestamp() 
            });
            alert(translations[lang].msgSuccess);
        }

        function loadData(lang) {
            db.collection("bookings").orderBy("timestamp", "desc").onSnapshot(snap => {
                const table = document.getElementById('bTable');
                table.innerHTML = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    const t = translations[lang];
                    table.innerHTML += `<tr>
                        <td>${d.patient}</td>
                        <td>${d.nationalID}</td>
                        <td>${d.doctor}</td>
                        <td><strong>${d.time || '---'}</strong></td>
                        <td><button class="btn-del" onclick="confirmDelete('${doc.id}')">${t.delBtn}</button></td>
                    </tr>`;
                });
            });
        }

        async function confirmDelete(id) {
            const lang = localStorage.getItem('lang') || 'ar';
            if(confirm(translations[lang].msgConfirm)) {
                await db.collection('bookings').doc(id).delete();
            }
        }

        const savedLang = localStorage.getItem('lang') || 'ar';
        setLanguage(savedLang);
    </script>
</body>
</html>
