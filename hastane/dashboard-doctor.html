<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ - HASTANE</title>
    <style>
        :root { --primary: #1b4332; --secondary: #2d6a4f; --bg: #f0f4f3; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; }
        
        .top-bar { 
            background: var(--primary); color: white; padding: 20px 8%; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
        
        .patient-card { 
            background: white; padding: 25px; border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 15px; 
            display: flex; justify-content: space-between; align-items: center;
            border-right: 6px solid var(--primary);
        }
        
        .patient-info h4 { margin: 0; color: var(--primary); font-size: 1.2rem; }
        .patient-info p { margin: 5px 0 0; color: #666; font-size: 0.9rem; }
        
        .badge-time { background: #d8f3dc; color: #1b4332; padding: 8px 15px; border-radius: 10px; font-weight: bold; }
        
        .btn-done { 
            background: none; border: 1px solid #ddd; color: #999; 
            padding: 8px 15px; border-radius: 8px; cursor: pointer; transition: 0.3s;
        }
        .btn-done:hover { background: #e74c3c; color: white; border-color: #e74c3c; }
        
        .stats-bar { display: flex; gap: 20px; margin-bottom: 25px; }
        .stat-item { background: var(--primary); color: white; padding: 15px 25px; border-radius: 12px; flex: 1; text-align: center; }
    </style>
</head>
<body>
    <div class="top-bar">
        <div>
            <h2 style="margin:0;">Ø¯ÙƒØªÙˆØ± Ø£Ø­Ù…Ø¯</h2>
            <small id="officeDisplay">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©...</small>
        </div>
        <button onclick="location.href='index.html'" style="background:none; border:1px solid white; color:white; padding:8px 15px; border-radius:5px; cursor:pointer;">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="container">
        <div class="stats-bar">
            <div class="stat-item">Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…: <span id="count">0</span></div>
        </div>

        <h3 style="color:var(--primary);">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ†</h3>
        <div id="pList"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
        const firebaseConfig = {
            apiKey: "AIzaSyBD2Ge6v0TStampv_l_bRGnzTDVPKvCW20",
            authDomain: "hastane-b2c48.firebaseapp.com",
            projectId: "hastane-b2c48",
            storageBucket: "hastane-b2c48.firebasestorage.app",
            messagingSenderId: "788913029956",
            appId: "1:788913029956:web:84c2f36a5569c85bfd8d11"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ± Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø­Ø¬Ø²
        const doctorName = "Ø¯. Ø£Ø­Ù…Ø¯"; 

        db.collection("bookings")
          .where("doctor", "==", doctorName)
          .onSnapshot(snap => {
            const list = document.getElementById('pList');
            const countDisplay = document.getElementById('count');
            list.innerHTML = "";
            countDisplay.innerText = snap.size;

            if (snap.empty) {
                list.innerHTML = "<p style='text-align:center; color:#999;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø­Ø¬ÙˆØ²Ø© Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ….</p>";
                return;
            }

            snap.forEach(doc => {
                const d = doc.data();
                // Ø¹Ø±Ø¶ Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙƒØªØ¨ Ù…Ù† Ø£ÙˆÙ„ Ø­Ø¬Ø² Ù…ØªØ§Ø­
                document.getElementById('officeDisplay').innerText = d.office || "Ù‚Ø³Ù… Ø§Ù„Ø¹ÙŠÙˆÙ†";

                list.innerHTML += `
                <div class="patient-card">
                    <div class="patient-info">
                        <h4>${d.patient}</h4>
                        <p>ğŸ†” Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ: ${d.nationalID}</p>
                        <p>ğŸ•’ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©: <strong>${d.time}</strong></p>
                    </div>
                    <div style="display:flex; align-items:center; gap:15px;">
                        <div class="badge-time">Ù…ÙˆØ¹Ø¯ Ù…Ø¤ÙƒØ¯</div>
                        <button class="btn-done" onclick="deletePatient('${doc.id}')">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙƒØ´Ù</button>
                    </div>
                </div>`;
            });
        });

        // ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙƒØ´Ù (Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙŠØ¶ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
        async function deletePatient(id) {
            if(confirm("Ù‡Ù„ Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø§Ù„ÙƒØ´Ù Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶ØŸ")) {
                await db.collection("bookings").doc(id).delete();
            }
        }
    </script>
</body>
</html>