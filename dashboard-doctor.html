<!DOCTYPE html>
<html lang="ar" dir="rtl" id="main-html">
<head>
    <meta charset="UTF-8">
    <title id="page-title">Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ - HASTANE</title>
    <style>
        :root { --primary: #1b4332; --secondary: #2d6a4f; --bg: #f0f4f3; --white: #fff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; transition: 0.3s; }
        
        .top-bar { 
            background: var(--primary); color: white; padding: 20px 8%; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„ØºØ© Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ */
        .lang-switcher { display: flex; gap: 5px; margin-bottom: 10px; }
        .lang-btn { cursor: pointer; border: 1px solid #ffffff44; padding: 4px 8px; border-radius: 5px; font-size: 0.7rem; background: rgba(255,255,255,0.1); color: white; font-weight: bold; }
        .lang-btn:hover { background: rgba(255,255,255,0.2); }

        .container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
        
        .patient-card { 
            background: white; padding: 25px; border-radius: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 15px; 
            display: flex; justify-content: space-between; align-items: center;
            border-right: 6px solid var(--primary); transition: 0.3s;
        }
        [dir="ltr"] .patient-card { border-right: none; border-left: 6px solid var(--primary); }
        
        .patient-info h4 { margin: 0; color: var(--primary); font-size: 1.2rem; }
        .patient-info p { margin: 5px 0 0; color: #666; font-size: 0.9rem; }
        
        .badge-time { background: #d8f3dc; color: #1b4332; padding: 8px 15px; border-radius: 10px; font-weight: bold; font-size: 0.85rem; }
        
        .btn-done { 
            background: none; border: 1px solid #ddd; color: #999; 
            padding: 8px 15px; border-radius: 8px; cursor: pointer; transition: 0.3s;
        }
        .btn-done:hover { background: #e74c3c; color: white; border-color: #e74c3c; }
        
        .stats-bar { display: flex; gap: 20px; margin-bottom: 25px; }
        .stat-item { background: var(--primary); color: white; padding: 15px 25px; border-radius: 12px; flex: 1; text-align: center; font-weight: bold; }
        
        .logout-btn { background:none; border:1px solid white; color:white; padding:8px 15px; border-radius:5px; cursor:pointer; font-weight:bold; }
    </style>
</head>
<body>
    <div class="top-bar">
        <div>
            <div class="lang-switcher">
                <button class="lang-btn" onclick="setLanguage('ar')">AR</button>
                <button class="lang-btn" onclick="setLanguage('tr')">TR</button>
                <button class="lang-btn" onclick="setLanguage('en')">EN</button>
            </div>
            <h2 id="doc-name-display" style="margin:0;">Ø¯ÙƒØªÙˆØ± Ø£Ø­Ù…Ø¯</h2>
            <small id="officeDisplay">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</small>
        </div>
        <button id="btn-logout" class="logout-btn" onclick="location.href='index.html'">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="container">
        <div class="stats-bar">
            <div class="stat-item"><span id="txt-stats">Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…:</span> <span id="count">0</span></div>
        </div>

        <h3 id="txt-list-title" style="color:var(--primary);">ðŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ†</h3>
        <div id="pList"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBD2Ge6v0TStampv_l_bRGnzTDVPKvCW20",
            authDomain: "hastane-b2c48.firebaseapp.com",
            projectId: "hastane-b2c48",
            storageBucket: "hastane-b2c48.firebasestorage.app",
            messagingSenderId: "788913029956",
            appId: "1:788913029956:web:84c2f36a5569c85bfd8d11"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const translations = {
            ar: {
                title: "Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ - HASTANE",
                docName: "Ø¯ÙƒØªÙˆØ± Ø£Ø­Ù…Ø¯",
                logout: "Ø®Ø±ÙˆØ¬",
                stats: "Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…: ",
                listTitle: "ðŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ÙŠÙ†",
                nationalID: "ðŸ†” Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ: ",
                selectedTime: "ðŸ•’ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©: ",
                confirmed: "Ù…ÙˆØ¹Ø¯ Ù…Ø¤ÙƒØ¯",
                done: "Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙƒØ´Ù",
                noPatients: "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø­Ø¬ÙˆØ²Ø© Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ….",
                confirmMsg: "Ù‡Ù„ Ø§Ù†ØªÙ‡ÙŠØª Ù…Ù† Ø§Ù„ÙƒØ´Ù Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶ØŸ",
                dir: "rtl"
            },
            tr: {
                title: "Doktor Paneli - HASTANE",
                docName: "Dr. Ahmet",
                logout: "Ã‡Ä±kÄ±ÅŸ",
                stats: "BugÃ¼n KayÄ±tlÄ± Hastalar: ",
                listTitle: "ðŸ“‹ Bekleyen Hasta Listesi",
                nationalID: "ðŸ†” T.C. Kimlik: ",
                selectedTime: "ðŸ•’ SeÃ§ilen Saat: ",
                confirmed: "OnaylandÄ±",
                done: "Muayeneyi Bitir",
                noPatients: "BugÃ¼n iÃ§in randevunuz bulunmamaktadÄ±r.",
                confirmMsg: "Bu hastanÄ±n muayenesini bitirdiniz mi?",
                dir: "ltr"
            },
            en: {
                title: "Doctor Dashboard - HASTANE",
                docName: "Dr. Ahmed",
                logout: "Logout",
                stats: "Patients Registered Today: ",
                listTitle: "ðŸ“‹ Waiting Patient List",
                nationalID: "ðŸ†” National ID: ",
                selectedTime: "ðŸ•’ Selected Time: ",
                confirmed: "Confirmed",
                done: "Finish Visit",
                noPatients: "No appointments booked for you today.",
                confirmMsg: "Have you finished the examination for this patient?",
                dir: "ltr"
            }
        };

        function setLanguage(lang) {
            localStorage.setItem('lang', lang);
            const t = translations[lang];
            const html = document.getElementById('main-html');
            html.dir = t.dir;
            html.lang = lang;

            document.getElementById('page-title').innerText = t.title;
            document.getElementById('doc-name-display').innerText = t.docName;
            document.getElementById('btn-logout').innerText = t.logout;
            document.getElementById('txt-stats').innerText = t.stats;
            document.getElementById('txt-list-title').innerText = t.listTitle;

            loadLiveUpdates(lang);
        }

        const doctorName = "Ø¯. Ø£Ø­Ù…Ø¯"; 

        function loadLiveUpdates(lang) {
            db.collection("bookings")
              .where("doctor", "==", doctorName)
              .onSnapshot(snap => {
                const list = document.getElementById('pList');
                const countDisplay = document.getElementById('count');
                const t = translations[lang];
                
                list.innerHTML = "";
                countDisplay.innerText = snap.size;

                if (snap.empty) {
                    list.innerHTML = `<p style='text-align:center; color:#999;'>${t.noPatients}</p>`;
                    return;
                }

                snap.forEach(doc => {
                    const d = doc.data();
                    document.getElementById('officeDisplay').innerText = d.office || "---";

                    list.innerHTML += `
                    <div class="patient-card">
                        <div class="patient-info">
                            <h4>${d.patient}</h4>
                            <p>${t.nationalID} ${d.nationalID}</p>
                            <p>${t.selectedTime} <strong>${d.time}</strong></p>
                        </div>
                        <div style="display:flex; align-items:center; gap:15px;">
                            <div class="badge-time">${t.confirmed}</div>
                            <button class="btn-done" onclick="deletePatient('${doc.id}')">${t.done}</button>
                        </div>
                    </div>`;
                });
            });
        }

        async function deletePatient(id) {
            const lang = localStorage.getItem('lang') || 'ar';
            if(confirm(translations[lang].confirmMsg)) {
                await db.collection("bookings").doc(id).delete();
            }
        }

        const savedLang = localStorage.getItem('lang') || 'ar';
        setLanguage(savedLang);
    </script>
</body>
</html>
